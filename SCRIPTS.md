# Optional scripts

Add this script to `.bashrc`, `.bash_profile`, or an analogous file for your shell. After adding the script, source the file with `source /path/to/file`. 

These haven't been tested on Windows, and probably would not work unless you use Git Bash or WSL.

## Preserving shell history

The default installation spawns a subshell which doesn't share the previous process's history. To preserve the history, use this script. It also bypasses the wrapper for commands that should print directly to the terminal (like `install` and `completions`). 

```bash
# sb shell function to preserve history after switching directory
sb() {
  # Bypass wrapper for commands that must print directly
  case "$1" in
    install|-h|--help|completions)
      command sb "$@"
      return
      ;;
  esac
  local out dir branch
  out=$(SB_SHELL_WRAPPER=1 command sb "$@")
  dir=$(echo "$out" | grep '^DIR:' | cut -d: -f2- | xargs)
  branch=$(echo "$out" | grep '^BRANCH:' | cut -d: -f2- | xargs)
  [ -n "$dir" ] || return
  cd "$dir" || return
  if [ -n "$branch" ]; then
    git checkout "$branch"
  fi
}
```

## Completions

Completions can be generated by the following script.

```bash
# _sb_complete generates shell completions for sb
_sb_complete() {
  local cur slugs
  cur="${COMP_WORDS[COMP_CWORD]}"
  # Use `command sb` to bypass the shell function wrapper
  slugs=$(command sb completions)
  COMPREPLY=( $(compgen -W "${slugs}" -- ${cur}) )
}
complete -F _sb_complete sb
```